"use strict";(self.webpackChunkserenity_users_guide=self.webpackChunkserenity_users_guide||[]).push([[671],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),m=o,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||r;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7289:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return d}});var a=n(3117),o=n(102),r=(n(7294),n(3905)),i=["components"],s={id:"screenplay_fundamentals",sidebar_position:1},l="Screenplay Fundamentals",c={unversionedId:"screenplay/screenplay_fundamentals",id:"screenplay/screenplay_fundamentals",title:"Screenplay Fundamentals",description:"The Screenplay Pattern is a modern test automation design pattern intented to make it easier to write scalabble, maintainable test code. You can get a quick overview of a simple Screenplay test here.",source:"@site/docs/screenplay/screenplay_fundamentals.md",sourceDirName:"screenplay",slug:"/screenplay/screenplay_fundamentals",permalink:"/documentation/docs/screenplay/screenplay_fundamentals",draft:!1,editUrl:"https://github.com/serenity-bdd/documentation/docs/screenplay/screenplay_fundamentals.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"screenplay_fundamentals",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Running Cucumber scenarios with Serenity",permalink:"/documentation/docs/guide/cucumber"},next:{title:"Web Testing with Serenity Screenplay",permalink:"/documentation/docs/screenplay/screenplay_webdriver"}},p={},d=[{value:"Setting up a Screenplay test",id:"setting-up-a-screenplay-test",level:2},{value:"Screenplay and JUnit 4",id:"screenplay-and-junit-4",level:3},{value:"Screenplay and JUnit 5",id:"screenplay-and-junit-5",level:3},{value:"Screenplay and Cucumber",id:"screenplay-and-cucumber",level:3},{value:"Defining the actors",id:"defining-the-actors",level:2},{value:"Actors in JUnit",id:"actors-in-junit",level:3},{value:"Defining actors using the CastMember annotation",id:"defining-actors-using-the-castmember-annotation",level:3},{value:"Actors in Cucumber",id:"actors-in-cucumber",level:3},{value:"Using a Managed driver with Cucumber",id:"using-a-managed-driver-with-cucumber",level:4},{value:"Casts and Stages",id:"casts-and-stages",level:4},{value:"The Actor in the spotlight",id:"the-actor-in-the-spotlight",level:4},{value:"Grouping interactions into tasks",id:"grouping-interactions-into-tasks",level:2},{value:"Grouping interactions using the Task class",id:"grouping-interactions-using-the-task-class",level:3},{value:"Using lambda expressions to create custom tasks",id:"using-lambda-expressions-to-create-custom-tasks",level:3},{value:"Writing custom Performable classes.",id:"writing-custom-performable-classes",level:3},{value:"Questions - querying the state of the system",id:"questions---querying-the-state-of-the-system",level:2},{value:"Using bundled Question classes",id:"using-bundled-question-classes",level:3},{value:"Creating custom Questions using Lambda expressions",id:"creating-custom-questions-using-lambda-expressions",level:3},{value:"Making questions more readable with the <code>Question.about()</code> method",id:"making-questions-more-readable-with-the-questionabout-method",level:3},{value:"Converting Questions",id:"converting-questions",level:3},{value:"Converting date values",id:"converting-date-values",level:3},{value:"Converting to lists of values",id:"converting-to-lists-of-values",level:3},{value:"Working with collections",id:"working-with-collections",level:3},{value:"Conclusion",id:"conclusion",level:2}],u={toc:d};function m(e){var t=e.components,s=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"screenplay-fundamentals"},"Screenplay Fundamentals"),(0,r.kt)("p",null,"The Screenplay Pattern is a modern test automation design pattern intented to make it easier to write scalabble, maintainable test code. You can get a quick overview of a simple Screenplay test ",(0,r.kt)("a",{parentName:"p",href:"../../docs/tutorials/screenplay"},"here"),"."),(0,r.kt)("p",null,"In this section, we will look at how to write high quality test automation using the Screenplay pattern in more detail. We will intially focus on interacting with a web application using Selenium - in the following sections, we will see how to interact with APIs and databases using the Screenplay model."),(0,r.kt)("p",null,"In Screenplay we model ",(0,r.kt)("em",{parentName:"p"},"actors")," who interact with an application in various ways to perform ",(0,r.kt)("em",{parentName:"p"},"tasks")," that help them acheive their goals. Actors have ",(0,r.kt)("em",{parentName:"p"},"abilities"),", such as the ability to interact with a web browser or query a database, that help them perform these tasks. Actors can also answer ",(0,r.kt)("em",{parentName:"p"},"questions")," about the state of the system, so that we can check whether a feature is behaving the way we would expect it to."),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(1939).Z,width:"1355",height:"641"})),(0,r.kt)("h2",{id:"setting-up-a-screenplay-test"},"Setting up a Screenplay test"),(0,r.kt)("p",null,"Serenity BDD Screenplay tests can be written using any framwork that works with Serenity BDD. We will start by discussing how to set up a simple Serenity Screenplay test case using common libraries such as JUnit 4, JUnit 5 and Cucumber."),(0,r.kt)("h3",{id:"screenplay-and-junit-4"},"Screenplay and JUnit 4"),(0,r.kt)("p",null,"Running a Screenplay test in JUnit 4 and JUnit 5 is no different to any other Serenity BDD test. For JUnit 4, add the ",(0,r.kt)("inlineCode",{parentName:"p"},"serenity-junit")," dependency to your project if it is not already there:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"        <dependency>\n            <groupId>net.serenity-bdd</groupId>\n            <artifactId>serenity-junit</artifactId>\n            <version>${serenity.version}</version>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>net.serenity-bdd</groupId>\n            <artifactId>serenity-screenplay</artifactId>\n            <version>${serenity.version}</version>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>net.serenity-bdd</groupId>\n            <artifactId>serenity-screenplay-webdriver</artifactId>\n            <version>${serenity.version}</version>\n            <scope>test</scope>\n        </dependency>\n")),(0,r.kt)("p",null,"Next, use the ",(0,r.kt)("inlineCode",{parentName:"p"},"SerenityRunner")," class in your test class, like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"import net.serenitybdd.junit.runners.SerenityRunner;\nimport org.junit.Test;\n\n@RunWith(SerenityRunner.class)\npublic class AddNewTodos {\n\n    @Test\n    public void addToEmptyList() {...}\n}\n")),(0,r.kt)("h3",{id:"screenplay-and-junit-5"},"Screenplay and JUnit 5"),(0,r.kt)("p",null,"For JUnit 5, just add the following dependency to your project (this will also support legacy JUnit 4 tests):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"        <dependency>\n            <groupId>net.serenity-bdd</groupId>\n            <artifactId>serenity-junit5</artifactId>\n            <version>${serenity.version}</version>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>net.serenity-bdd</groupId>\n            <artifactId>serenity-screenplay</artifactId>\n            <version>${serenity.version}</version>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>net.serenity-bdd</groupId>\n            <artifactId>serenity-screenplay-webdriver</artifactId>\n            <version>${serenity.version}</version>\n            <scope>test</scope>\n        </dependency>\n")),(0,r.kt)("p",null,"Next, you need to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"SerenityJUnit5Extension")," class, like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import net.serenitybdd.junit.runners.SerenityJUnit5Extension;\nimport org.junit.jupiter.api.Test;\n\n@ExtendWith(SerenityJUnit5Extension.class)\nclass AddNewTodos {\n\n    @Test\n    @DisplayName("Add a todo item to an empty list")\n    void addToEmptyList() {...}\n}\n')),(0,r.kt)("h3",{id:"screenplay-and-cucumber"},"Screenplay and Cucumber"),(0,r.kt)("p",null,"To run a Screenplay scenario with Cucumber and Serenity, you just need the standard Screenplay dependencies along with the ",(0,r.kt)("inlineCode",{parentName:"p"},"serenity-cucumber")," dependency, as shown below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"        <dependency>\n            <groupId>net.serenity-bdd</groupId>\n            <artifactId>serenity-cucumber</artifactId>\n            <version>${serenity.version}</version>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>net.serenity-bdd</groupId>\n            <artifactId>serenity-screenplay</artifactId>\n            <version>${serenity.version}</version>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>net.serenity-bdd</groupId>\n            <artifactId>serenity-screenplay-webdriver</artifactId>\n            <version>${serenity.version}</version>\n            <scope>test</scope>\n        </dependency>\n")),(0,r.kt)("p",null,"There is no difference when running the Cucumber scenarios either - you simply use the same JUnit 4 runner class as you would for a normal Serenity Cucumber scenario:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import io.cucumber.junit.CucumberOptions;\nimport net.serenitybdd.cucumber.CucumberWithSerenity;\nimport org.junit.runner.RunWith;\n\n@RunWith(CucumberWithSerenity.class)\n@CucumberOptions(\n        features = "classpath:features"\n)\npublic class TestSuite {}\n')),(0,r.kt)("h2",{id:"defining-the-actors"},"Defining the actors"),(0,r.kt)("p",null,"Every Screenplay test needs at least one actor (and some have several). There are several ways we can define an actor, which vary slightly depending on the test framework you are using."),(0,r.kt)("h3",{id:"actors-in-junit"},"Actors in JUnit"),(0,r.kt)("p",null,"One way to create a new actor is to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"Actor.named()")," method. For example, to create an actor named Toby, we could write the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Actor toby = Actor.named("Toby");\n')),(0,r.kt)("p",null,"However this actor will not be able to do very much until we give him the ability to interact with our application. That's where ",(0,r.kt)("em",{parentName:"p"},"abilities")," come into play."),(0,r.kt)("p",null,"The most commonly-needed ability is the ability to browse the web using a web automation library such as Selenium or Playwright. In a Serenity JUnit test, we can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"@Managed")," annotation to manage the WebDriver lifecycle. Once we have a driver available, we can assign it to an actor using the ",(0,r.kt)("inlineCode",{parentName:"p"},"BrowseTheWeb")," class like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@ExtendWith(SerenityJUnit5Extension.class)\nclass AddNewTodosWithAManagedDriver {\n\n    @Managed\n    WebDriver driver;\n\n    @Test\n    @DisplayName("Add a todo item to an empty list")\n    void addToEmptyList() {\n        Actor toby = Actor.named("Toby")\n                          .whoCan(BrowseTheWeb.with(driver));\n    ...\n    }\n}\n')),(0,r.kt)("h3",{id:"defining-actors-using-the-castmember-annotation"},"Defining actors using the CastMember annotation"),(0,r.kt)("p",null,"For many scenarios we can simplify this code shown above. If we just need to use an actor who can interact with a website using Selenium, we can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"@CastMember")," annotation. This annotation will configure an actor with a WebDriver instance, and manage the browser lifecycle for us (so no need for the ",(0,r.kt)("inlineCode",{parentName:"p"},"@Managed")," annotation or ",(0,r.kt)("inlineCode",{parentName:"p"},"WebDriver")," variable). You can see an example of this annotation in action here:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@ExtendWith(SerenityJUnit5Extension.class)\nclass AddNewTodosWithACastMember {\n\n    @CastMember\n    Actor toby;\n\n    @Test\n    @DisplayName("Add a todo item to an empty list")\n    void addToEmptyList() {\n\n        toby.attemptsTo(\n                Open.browserOn().the(TodoMvcPage.class),\n                Enter.theValue("Buy some milk").into(".new-todo").thenHit(Keys.RETURN)\n        );\n        Collection<String> items = toby.asksFor(Text.ofEach(".todo-list label"));\n        assertThat(items).containsExactly("Buy some milk");\n\n        String title = toby.asksFor(Text.of(By.tagName("h1")));\n        assertThat(title).isEqualTo("todos");\n    }\n}\n')),(0,r.kt)("p",null,"The name of the actor will be derived from the name of the variable. If you need a more descriptive name, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," attribute to provide a free text value, which will be used in the reports:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    @CastMember(name = "Tim the Enchanter")\n    Actor tim;\n')),(0,r.kt)("h3",{id:"actors-in-cucumber"},"Actors in Cucumber"),(0,r.kt)("p",null,"Setting up actors in Cucumber is a little more compicated than in JUnit, because we generally refer to them by name in the Cucumber scenarios. Suppose for example we want to automate the following scenario:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-gherkin"},'  Scenario: Add items to an empty list\n    Given Toby starts with an empty list\n    When he adds "Buy some milk" to his list\n    Then the todo list should contain the following items:\n      | Buy some milk |\n')),(0,r.kt)("h4",{id:"using-a-managed-driver-with-cucumber"},"Using a Managed driver with Cucumber"),(0,r.kt)("p",null,"We can use the same approach as we used for JUnit in our Cucumber step definition files, declaring a Webdriver instance using the ",(0,r.kt)("inlineCode",{parentName:"p"},"@Managed")," annotation and assigning it to our actor using the ",(0,r.kt)("inlineCode",{parentName:"p"},"BrowseTheWeb")," ability class:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class TodoStepDefinitions {\n\n    @Managed\n    WebDriver driver;\n\n    Actor toby = Actor.named("Toby");\n\n    @Before\n    public void setupActor() {\n        toby.can(BrowseTheWeb.with(driver));\n    }\n\n    @Given("Toby starts with an empty list")\n    public void stats_with_an_empty_list() {\n        toby.attemptsTo(\n                Open.url("https://todomvc.com/examples/angularjs/#/")\n        );\n    }\n')),(0,r.kt)("p",null,'However, the name of the actor ("Toby") is part of the scenario steps. We may want to have other scenarios with other actors, or have a scenario involving more than one actor. '),(0,r.kt)("h4",{id:"casts-and-stages"},"Casts and Stages"),(0,r.kt)("p",null,"We can make our Cucumber step definitions more flexible by introducing the concept of a ",(0,r.kt)("em",{parentName:"p"},"Cast")," of actors, and a ",(0,r.kt)("em",{parentName:"p"},"stage")," on which they perform. "),(0,r.kt)("p",null,"A ",(0,r.kt)("em",{parentName:"p"},"Cast")," is a class whose job is to provide actors with a specific set of abilities, when we need them to play a role in our tests. For example, we can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"OnlineCast")," class to provide actors who are equiped with their own Webdriver instances. This way, we don't need to declare the ",(0,r.kt)("inlineCode",{parentName:"p"},"@Managed")," driver, and each actor can have their own browser if we have a scenario with more than one actor."),(0,r.kt)("p",null,"A ",(0,r.kt)("em",{parentName:"p"},"stage")," is where our actors perform their roles. A scenario has a single stage, that we can use to identify an actor by name or find the currently active actor. "),(0,r.kt)("p",null,"We need to assign a cast to the stage at the start of each scenario; we can do this by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"OnStage.setTheStage()")," method and passing in a specific cast, like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"OnStage.setTheStage(new OnlineCast());\n")),(0,r.kt)("p",null,"Once we have set the stage, we can obtain an actor with a given name using the ",(0,r.kt)("inlineCode",{parentName:"p"},"OnState.theActorCalled()")," method, like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Actor toby = OnStage.theActorCalled("Toby");\n')),(0,r.kt)("p",null,"Using this approach, we could implement the first step of our scenario in a way that will work no matter which actor is involved, like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    @Given("{word} starts with an empty list")\n    public void stats_with_an_empty_list(String actorName) {\n        Actor actor = OnStage.theActorCalled(actorName);\n        actor.attemptsTo(\n                Open.url("https://todomvc.com/examples/angularjs/#/")\n        );\n    }\n')),(0,r.kt)("p",null,"We could even define a custom Cucumber expression so that we don't have to call the ",(0,r.kt)("inlineCode",{parentName:"p"},"OnStage.theActorCalled()")," method each time:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    @ParameterType(".*")\n    public Actor actor(String actorName) {\n        return OnStage.theActorCalled(actorName);\n    }\n\n    @Given("{actor} starts with an empty list")\n    public void stats_with_an_empty_list(Actor actor) {\n        actor.attemptsTo(\n                Open.url("https://todomvc.com/examples/angularjs/#/")\n        );\n    }\n')),(0,r.kt)("p",null,"This way, our next step can simply use a parameter of type ",(0,r.kt)("inlineCode",{parentName:"p"},"Actor"),", like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    @When("{actor} adds {string} to his list")\n    public void he_adds_to_his_list(Actor actor, String item) {\n        actor.attemptsTo(\n                Enter.theValue(item).into(".new-todo").thenHit(Keys.RETURN)\n        );\n    }\n')),(0,r.kt)("h4",{id:"the-actor-in-the-spotlight"},"The Actor in the spotlight"),(0,r.kt)("p",null,'Sometimes a step does not refer to an actor by name, but implicitly refers to the last actor who did anything in the scenario. For example, the third step, "Then the todo list should contain the following items..." does not have an explicit actor. '),(0,r.kt)("p",null,"In these situations, we can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"OnStage.theActorInTheSpotlight()")," method to refer to the last known active actor. For example, we could implement the third step of our scenario like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    @Then("the todo list should contain the following items:")\n    public void the_todo_list_should_contain(List<String> expectedItems) {\n        Actor currentActor = OnStage.theActorInTheSpotlight();\n        var todos = currentActor.asksFor(Text.ofEach(".todo-list li"));\n        assertThat(todos).containsExactlyElementsOf(expectedItems);\n    }\n')),(0,r.kt)("h2",{id:"grouping-interactions-into-tasks"},"Grouping interactions into tasks"),(0,r.kt)("p",null,"Screenplay aims to make it easy to write maintainable and scaleable automation code. And an important way to do this is by grouping interactions into reusable sequences that represent higher level domain concepts."),(0,r.kt)("p",null,"For example, the following test shows how to login to the ",(0,r.kt)("a",{parentName:"p",href:"https://www.saucedemo.com/"},"https://www.saucedemo.com/")," test site:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'        toby.attemptsTo(\n                Open.url("https://www.saucedemo.com/"),\n                Enter.theValue("standard_user").into("#user-name"),\n                Enter.theValue("secret_sauce").into("#password"),\n                Click.on("#login-button")\n        );\n')),(0,r.kt)("p",null,"These four lines involve all login in to the site. However it is hard to see that at a glance when reading the code. We could make this code much more readable by grouping these interactions into a single task. "),(0,r.kt)("h3",{id:"grouping-interactions-using-the-task-class"},"Grouping interactions using the Task class"),(0,r.kt)("p",null,"A better approach would be to group these related interactions into a single ",(0,r.kt)("inlineCode",{parentName:"p"},"Task"),". "),(0,r.kt)("p",null,"The simplest way to do this is to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"Task.where()")," method. This method lets us return a task (or more precisely, an implementation of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Performable")," interface) that combines several other tasks or interactions. "),(0,r.kt)("p",null,"The task that allows an actor to login as a standard user could look like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class Login {\n    public static Task asAStandardUser() {\n        return Task.where(\n                Open.url("https://www.saucedemo.com/"),\n                Enter.theValue("standard_user").into("#user-name"),\n                Enter.theValue("secret_sauce").into("#password"),\n                Click.on("#login-button")\n        );\n    }\n}\n')),(0,r.kt)("p",null,"We might want to make our task more configurable, by adding some parameters to the method signature. In this case, it is useful to make our task more descriptive by adding a text description before the list of _Performable_s, as shown below. This description will appear in the reports whenever the task is executed. The ",(0,r.kt)("inlineCode",{parentName:"p"},"{0}"),' in the description will be replaced by the name of the actor (so "Toby" in our test). '),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class Login {\n    public static Performable as(String username, String password) {\n        return Task.where(\n                "{0} logs in as " + username,\n                Open.url("https://www.saucedemo.com/"),\n                Enter.theValue(username).into("#user-name"),\n                Enter.theValue(password).into("#password"),\n                Click.on("#login-button")\n        );\n    }\n}\n')),(0,r.kt)("p",null,"We can now refactor our original test using this method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"        toby.attemptsTo(Login.asAStandardUser());\n")),(0,r.kt)("p",null,"or"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'        toby.attemptsTo(Login.as("standard_user","secret_sauce"));\n')),(0,r.kt)("h3",{id:"using-lambda-expressions-to-create-custom-tasks"},"Using lambda expressions to create custom tasks"),(0,r.kt)("p",null,"So far we havce seen how to create a ",(0,r.kt)("em",{parentName:"p"},"Task")," from a list of other tasks or interactions. But sometimes we need to have more control over the logic of our task. We can do this very easily using lambda expressions, which give us total control over how our task should work. "),(0,r.kt)("p",null,"For example, imagine we have refactored our TodoMVC example above to use the following Task class to open the TodoMVC application with an empty list:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'\npublic class Start {\n    public static Performable withAnEmptyTodoList() {\n        return Task.where("{0} starts with an empty todo list",\n                Open.url("https://todomvc.com/examples/angularjs/#/")\n        );\n    }\n')),(0,r.kt)("p",null,"We could also create a task to add a todo item to the list:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class AddATodoItem {\n    public static Performable called(String thingToDo) {\n        return Task.where("{0} adds a todo item called " + thingToDo,\n                Enter.theValue(item).into(".new-todo").thenHit(Keys.RETURN)\n        );\n    }\n}\n')),(0,r.kt)("p",null,"Now suppose we want to allow Toby to start with some elements already in his list. We could imagine a new ",(0,r.kt)("inlineCode",{parentName:"p"},"Start.withAListContainingTheItems(...)")," method like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'        toby.attemptsTo(\n                Start.withAListContaingTheItems("Feed the cat","Buy some bread")\n        );\n')),(0,r.kt)("p",null,"However to implement this method, we need to loop over the provided list of items, and call the ",(0,r.kt)("inlineCode",{parentName:"p"},"AddATodoItem")," task for each of them. We can do this by using a Lambda expression instead of a list of _Performable_s. The Lambda expression takes an actor as a parameter, and allows us to write arbitrary blocks of code to implement our task. For example, the ",(0,r.kt)("inlineCode",{parentName:"p"},"withAListContaingTheItems()")," method might look like the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    public static Performable withAListContainingTheItems(String... items) {\n        return Task.where("{0} starts with a list containing " + Arrays.asList(items),\n                actor -> {\n                    actor.attemptsTo(Start.withAnEmptyTodoList());\n                    for (String item : items) {\n                        actor.attemptsTo(AddATodoItem.called(item));\n                    }\n                }\n        );\n')),(0,r.kt)("p",null,"The full ",(0,r.kt)("inlineCode",{parentName:"p"},"Start")," class would now look like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class Start {\n    public static Performable withAnEmptyTodoList() {\n        return Task.where("{0} starts with an empty todo list",\n                Open.url("https://todomvc.com/examples/angularjs/#/")\n        );\n    }\n\n    public static Performable withAListContainingTheItems(String... items) {\n        return Task.where("{0} starts with a list containing " + Arrays.asList(items),\n                actor -> {\n                    actor.attemptsTo(Start.withAnEmptyTodoList());\n                    for (String item : items) {\n                        actor.attemptsTo(AddATodoItem.called(item));\n                    }\n                }\n        );\n    }\n}\n\n')),(0,r.kt)("h3",{id:"writing-custom-performable-classes"},"Writing custom Performable classes."),(0,r.kt)("p",null,"Sometimes we need more control over the creation of a Task. We can do this by creating a class that implements the ",(0,r.kt)("inlineCode",{parentName:"p"},"Performable")," interface. "),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Performable")," interface has a single method that you need to implement: ",(0,r.kt)("inlineCode",{parentName:"p"},"performAs()"),". This method takes an ",(0,r.kt)("inlineCode",{parentName:"p"},"Actor")," as a parameter. A very simple custom task might look like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class AddItem implements Performable {\n    @Override\n    public <T extends Actor> void performAs(T actor) {\n        actor.attemptsTo(\n                Enter.theValue("Buy some milk")\n                        .into(".new-todo")\n                        .thenHit(Keys.RETURN)\n        );\n    }\n}\n')),(0,r.kt)("p",null,"Now we can use this class directly in our tests:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"    AddItem addANewItem = new AddItem();\n    toby.attemptsTo(addANewItem);\n")),(0,r.kt)("p",null,'By default, Serenity will record this action in the reports using the name of the actor and the name of the class, so in this case, the report would include something like "Toby add item". If we want a more descriptive text, we can add the ',(0,r.kt)("inlineCode",{parentName:"p"},"@Step")," annotation to the ",(0,r.kt)("inlineCode",{parentName:"p"},"performAs()"),' method, as shown here (the "{0}" placeholder will be replaced by the name of the actor):'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class AddItem implements Performable {\n    @Override\n    @Step("{0} adds an item to the list")\n    public <T extends Actor> void performAs(T actor) {\n        actor.attemptsTo(\n                Enter.theValue("Buy some milk")\n                        .into(".new-todo")\n                        .thenHit(Keys.RETURN)\n        );\n    }\n}\n')),(0,r.kt)("p",null,'In this class, we can only add the item "Buy some milk" to our list. We could make our class more flexible by recordinh the name of the task as a parameter. To do this, we need to add a member variable to our ',(0,r.kt)("inlineCode",{parentName:"p"},"Performable")," to represent this value, and pass it in to the constructor:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class AddItem implements Performable {\n    private String name;\n\n    public AddItem(String name) {\n        this.name = name;\n    }\n\n    @Override\n    @Step("{0} adds an item to the list")\n    public <T extends Actor> void performAs(T actor) {\n        actor.attemptsTo(\n                Enter.theValue(name)\n                        .into(".new-todo")\n                        .thenHit(Keys.RETURN)\n        );\n    }\n\n    public static AddItem called(String name) {\n        return new AddItem(name);\n    }\n}\n')),(0,r.kt)("p",null,"We can now make our test code more readable, as shown here:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    toby.attemptsTo(AddItem.named("Walk the dog"));\n')),(0,r.kt)("p",null,"However there is one more thing we need to do to make this work correctly. The code shown here will not be correctly reported in the Serenity reports. For technical reasons, every ",(0,r.kt)("inlineCode",{parentName:"p"},"Performable")," implementation must have a default constructor, even if you don't use it directly in your code. So the complete implementation will look like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class AddItem implements Performable {\n    private String name;\n\n    public AddItem() {}\n\n    public AddItem(String name) {\n        this.name = name;\n    }\n\n    @Override\n    @Step("{0} adds an item to the list")\n    public <T extends Actor> void performAs(T actor) {\n        actor.attemptsTo(\n                Enter.theValue(name)\n                        .into(".new-todo")\n                        .thenHit(Keys.RETURN)\n        );\n    }\n\n    public static AddItem called(String name) {\n        return new AddItem(name);\n    }\n}\n')),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Always remember to add a default constructor with no parameters to your ",(0,r.kt)("inlineCode",{parentName:"p"},"Performable")," implementations, otherwise they will not appear correctly in the reports."))),(0,r.kt)("h2",{id:"questions---querying-the-state-of-the-system"},"Questions - querying the state of the system"),(0,r.kt)("p",null,"Screenplay is an actor-centric pattern, and just as actors interact with the system by performing ",(0,r.kt)("em",{parentName:"p"},"tasks")," and ",(0,r.kt)("em",{parentName:"p"},"interactions"),", they can query the state of the system by asking ",(0,r.kt)("em",{parentName:"p"},"questions"),"."),(0,r.kt)("h3",{id:"using-bundled-question-classes"},"Using bundled Question classes"),(0,r.kt)("p",null,"An actor can ask a question by using the ",(0,r.kt)("inlineCode",{parentName:"p"},"askFor()")," method. You can see an example of how this works here:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'   String pageTitle = toby.asksFor(Text.of(".title"));\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Text")," is an example of a ",(0,r.kt)("em",{parentName:"p"},"Question Factory"),". Question Factories provide a convenient way to query the state of the application, and there are many to choose from. For example, we could check whether a particular web element was visible using the ",(0,r.kt)("inlineCode",{parentName:"p"},"Visibility")," class, like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'   boolean isVisible = toby.asksFor(Visibility.of(".title"));\n')),(0,r.kt)("p",null,"Serenity BDD comes with lot bundled ",(0,r.kt)("em",{parentName:"p"},"Question Factories")," like these, and we will look at them in more detail in the next section. But you can also write your own custom questions, to query any aspect of your application that you like."),(0,r.kt)("h3",{id:"creating-custom-questions-using-lambda-expressions"},"Creating custom Questions using Lambda expressions"),(0,r.kt)("p",null,"One way to implement a ",(0,r.kt)("em",{parentName:"p"},"Question")," is to use a Java 8 Lambda expression that takes an ",(0,r.kt)("em",{parentName:"p"},"Actor")," as an argument. For example, the following method returns an ",(0,r.kt)("em",{parentName:"p"},"Integer Question")," (a ",(0,r.kt)("em",{parentName:"p"},"Question")," that returns an integer). "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    Question<Integer> numberOfTodoItems() {\n        return actor -> BrowseTheWeb.as(actor).findAll(".todo-list li").size();\n    }\n')),(0,r.kt)("p",null,"We could find the answer to this question using the ",(0,r.kt)("inlineCode",{parentName:"p"},"asksFor()")," method, as in the previous example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"   int numberOfTodos = toby.asksFor(numberOfTodoItems());\n")),(0,r.kt)("p",null,"An alternative to the ",(0,r.kt)("inlineCode",{parentName:"p"},"asksFor()")," method is the ",(0,r.kt)("inlineCode",{parentName:"p"},"Question"),"'s own ",(0,r.kt)("inlineCode",{parentName:"p"},"answeredBy()")," method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"   int numberOfTodos = numberOfTodoItems().answeredBy(toby);\n")),(0,r.kt)("p",null,"This format can be more convenient for assertions, as illustrated in this example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"   assertThat(numberOfTodoItems().answeredBy(toby)).isEqualTo(1);\n")),(0,r.kt)("h3",{id:"making-questions-more-readable-with-the-questionabout-method"},"Making questions more readable with the ",(0,r.kt)("inlineCode",{parentName:"h3"},"Question.about()")," method"),(0,r.kt)("p",null,"We could make this method more readable by using the ",(0,r.kt)("inlineCode",{parentName:"p"},"Question.about")," format - this will produce a more meaningful error message. In the following example, we use the ",(0,r.kt)("inlineCode",{parentName:"p"},"BrowseTheWeb")," class to access the Serenity WebDriver API and find the number of todo list items currently on the page:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    Question<Integer> numberOfTodoItems() {\n        return Question.about("the number of todo items")\n                   .answeredBy(\n                       actor -> BrowseTheWeb.as(actor).findAll(".todo-list li").size());\n    }\n')),(0,r.kt)("h3",{id:"converting-questions"},"Converting Questions"),(0,r.kt)("p",null,"Questions also provide a convenient way to convert responses into different types. This is particularly useful for the bundled WebDriver ",(0,r.kt)("inlineCode",{parentName:"p"},"Question")," classes, that typically return values in text form. "),(0,r.kt)("p",null,"For example, the TodoMVC application shows the number of items remaining to do at any time beneath the list:"),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(7345).Z,width:"1580",height:"1014"})),(0,r.kt)("p",null,"We can locate the item count using the CSS expression ",(0,r.kt)("em",{parentName:"p"},'".todo-count strong"'),". We could fetch this value as a String using the ",(0,r.kt)("inlineCode",{parentName:"p"},"Text")," class we saw previously:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    String itemsLeftCount = toby.asksFor(Text.of(".todo-count strong");\n')),(0,r.kt)("p",null,"However if we prefer to retrieve the value as an integer, we could use the ",(0,r.kt)("inlineCode",{parentName:"p"},"asInteger()")," method like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'   int itemsLeftCount = toby.asksFor(Text.of(".todo-count strong").asInteger());\n')),(0,r.kt)("p",null,"Some of the conversion methods available include the following:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Method"),(0,r.kt)("th",{parentName:"tr",align:null},"Example"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Integer"),(0,r.kt)("td",{parentName:"tr",align:null},"asInteger()"),(0,r.kt)("td",{parentName:"tr",align:null},'Text.of(".todo-count strong").asInteger()')),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Long"),(0,r.kt)("td",{parentName:"tr",align:null},"asLong()"),(0,r.kt)("td",{parentName:"tr",align:null},'Text.of(".todo-count strong").asLong()')),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Float"),(0,r.kt)("td",{parentName:"tr",align:null},"asFloat()"),(0,r.kt)("td",{parentName:"tr",align:null},'Text.of(".currency-value").asFloat()')),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Double"),(0,r.kt)("td",{parentName:"tr",align:null},"asDouble()"),(0,r.kt)("td",{parentName:"tr",align:null},'Text.of(".currency-value").asDouble()')),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"BigDecimal"),(0,r.kt)("td",{parentName:"tr",align:null},"asBigDecimal()"),(0,r.kt)("td",{parentName:"tr",align:null},'Text.of(".currency-value").asBigDecimal()')))),(0,r.kt)("h3",{id:"converting-date-values"},"Converting date values"),(0,r.kt)("p",null,"Date values can also be converted to ",(0,r.kt)("inlineCode",{parentName:"p"},"LocalDate"),' objects. If the date uses the standard ISO date format (e.g. "2022-05-15"), it can be converted using the ',(0,r.kt)("inlineCode",{parentName:"p"},"asDate()")," method, like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'   LocalDate dateValue = toby.asksFor(\n       Text.of("#departure-date").asDate()\n    );\n')),(0,r.kt)("p",null,"If the date uses a different format, the ",(0,r.kt)("inlineCode",{parentName:"p"},"asDate()")," method takes a date-time pattern that can be used to parse the value, e.g."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    LocalDate dateValue = toby.asksFor(\n        Text.of("#departure-date").asDate("d MMM uuuu")\n    );\n')),(0,r.kt)("h3",{id:"converting-to-lists-of-values"},"Converting to lists of values"),(0,r.kt)("p",null,"We can also use the ",(0,r.kt)("inlineCode",{parentName:"p"},"asListOf()")," method to find all the answers to a specific question, and convert each of them to a specified type. For example, to convert a list of matching String values to integers, we could use the following code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    List<Integer> itemQuantities = toby.asksFor(\n        Text.of(".item-quantity").asListOf(Integer.class)\n    );\n')),(0,r.kt)("h3",{id:"working-with-collections"},"Working with collections"),(0,r.kt)("p",null,"Another way to retrieve a list of values is to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"ofEach()")," method. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    Collection<String> itemQuantities = toby.asksFor(Text.of(".item-quantity"));\n')),(0,r.kt)("p",null,"As with the ",(0,r.kt)("inlineCode",{parentName:"p"},"Text.of()")," method, we can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"asListOf()")," method to convert this collection into another type"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    List<String> itemQuantities = toby.asksFor(\n        Text.of(".item-quantity").asListOf(Integer.class)\n    );\n')),(0,r.kt)("p",null,"If we need to perform a more complex operation, we can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"mapEach()")," method to apply an arbitrary Lambda expression to each matching element:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'   Collection<Integer> nameLengths = toby.asksFor(Text.ofEach(".name").mapEach(s -> s.length()));\n')),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"Now that we have seen how to set up a Screenplay test using different frameworks, how to organise interactions into tasks, and how to query the state of the system, we will look at how to use Screenplay to interact with a web application in more detail."))}m.isMDXComponent=!0},7345:function(e,t,n){t.Z=n.p+"assets/images/items-left-3ecf27bc1e1d2a5f0618de446edd32a3.png"},1939:function(e,t,n){t.Z=n.p+"assets/images/screenplay-model-d488f442690c701509fec447d3200a99.svg"}}]);